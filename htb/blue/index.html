<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="robots" content="noindex">

  <title>Writeup HackTheBox Blue</title>

  <meta name="description" content="Resolución de la máquina Blue de la plataforma de HackTheBox">
  <meta name="author" content="Md Amiruddin">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Writeup HackTheBox Blue">
  <meta name="twitter:description" content="Resolución de la máquina Blue de la plataforma de HackTheBox">
  <meta name="twitter:creator" content="Md Amiruddin">  
  <meta name="twitter:image" content="https://raw.githubusercontent.com/GatoGamer1155/Imagenes-Repositorios/main/ni/blue.png" />

  <meta property="og:site_name" content="Md Amiruddin" />
  <meta property="og:type" content="article">
  <meta property="og:title" content="Writeup HackTheBox Blue">
  <meta property="og:description" content="Resolución de la máquina Blue de la plataforma de HackTheBox">
  <meta property="og:image" content="https://raw.githubusercontent.com/GatoGamer1155/Imagenes-Repositorios/main/ni/blue.png" />

  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" type="image/png" sizes="64x64" href="https://raw.githubusercontent.com/GatoGamer1155/Imagenes-Repositorios/main/ni/blue.png">

  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">
  
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/css/main.css?1678854914750547280">
  <link rel="canonical" href="http://localhost:4000/">
  <link rel="alternate" type="application/rss+xml" title="Writeup HackTheBox Blue" href="/feed.xml">
</head>


    <span class="mobile btn-mobile-menu">
      <i class="icon icon-list btn-mobile-menu__icon"></i>
      <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

<header class="panel-cover" style="background-image: url(/images/cover.gif)">

  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
      <div class="panel-main__content">

          <img src="/images/profile.jpg" class="user-image zoomable" alt="Md Amiruddin">
          <h1 class="panel-cover__title panel-title scale-up-center">Md Amiruddin</h1>

        <hr class="panel-cover__divider">
        <p class="panel-cover__description slide-top">Entusiasta del Hacking y CTFs</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">
         <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item grow"><a href="/htb" title="Md Amiruddin" class="blog-button">HackTheBox</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">
              
             <li class="navigation__item grow">
                <a href="https://github.com/MdAmiruddin" title="Github" target="_blank">
                  <i class="icon icon-social-github"></i>
                  <span class="label">GitHub</span>
                </a>
              </li>

              <li class="navigation__item grow">
                <a href="https://linkedin.com/in/mdamiruddin" title="Linkedin" target="_blank">
                  <i class="icon icon-social-linkedin"></i>
                  <span class="label">Linkedin</span>
                </a>
              </li>
              
              <li class="navigation__item grow">
                <a href="https://mdamiruddin.medium.com" title="Medium" target="_blank">
                  <i class="icon icon-social-medium"></i>
                  <span class="label">Medium</span>
                </a>
              </li>
              
              <li class="navigation__item grow">
                <a href="mailto:sample@gmail.com" title="Correo Electronico" target="_blank">
                  <i class="icon icon-mail"></i>
                  <span class="label">Email</span>
                </a>
              </li>

            </ul>
          </nav>
        </div>
      </div>
    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>
    <br>
    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
    <div class="izquierda">
    
  </div>

  <header class="post-header slide-top">
   
    <html>
<head>
  <style type="text/css">
  body {
    background-color: #FFFFFF;
    color: #000000;
    font-family: Calibri, Sans Serif;
  }

  #switch {
    display: block ;
    position: fixed;
    top: 10px;
    right: 10px;
  }
  
  </style>
  <script type="text/javascript">
  document.addEventListener('DOMContentLoaded', toggleSwitcher);
  function toggleSwitcher() {
    // Set up the basic elements and their attributes
    var bodyTag = document.getElementsByTagName('body')[0];
    var divSwitcher = document.createElement('div');
    divSwitcher.setAttribute('id','switch');
    var toggleSwitch = document.createElement('input');
    toggleSwitch.setAttribute('type','checkbox');
    toggleSwitch.setAttribute('id','toggle-switch');
    divSwitcher.appendChild(toggleSwitch);

    // Add the toggleSwitcher to the body
    bodyTag.appendChild(divSwitcher);


    // Listen for a 'click' event
    toggleSwitch.addEventListener('click', toggleStyle);

    // Change the Style depending on the toggleSwitch state
    // UI: change the toggleSwitch color
    function toggleStyle() {
      if (document.getElementById('toggle-switch').checked) {
        // Dark Mode
        bodyTag.style.backgroundColor = '#1A1A1A';
        bodyTag.style.color = '#FFFFFF';
        toggleSwitch.style.backgroundColor = '#212121';
      } else {
        // Normal Mode
        bodyTag.style.backgroundColor = '#FFFFFF';
        bodyTag.style.color = '#000000';
        toggleSwitch.style.backgroundColor = '#E2E2E2';
      }
    }
  }
</script>
  <title>Toggle Light/Dark Mode</title>
</head>


    <picture><img src="https://raw.githubusercontent.com/GatoGamer1155/Imagenes-Repositorios/main/ni/blue.png" style="float: right; margin-right:0px; margin-left:0px; height:60px;" class="include_image zoomable"/></picture>
   
  </header>


  
<h1 id="tryhackme-sighunt-writeup-walkthrough">Tryhackme Sighunt Writeup/Walkthrough</h1>
<p>This room aims to be a supplementary room for Sigma rule creation. In this scenario, you will act as one of the Detection Engineers that will craft Sigma Rules based on the Indicators of Compromise (IOCs) collected by your Incident Responders.</p>
<p><img src="https://miro.medium.com/v2/resize:fit:700/1*dHYklK-25Rh154YQanVHgA.png" alt=""></p>
<p>Room Link :  <a href="https://tryhackme.com/room/sighunt">https://tryhackme.com/room/sighunt</a></p>
<h1 id="-prerequisites-"><strong>Prerequisites</strong></h1>
<p>This <a href="https://tryhackme.com/room/sighunt">room</a>  requires basic knowledge of detection engineering and Sigma rule creation. I recommend going through the following rooms before attempting this challenge.</p>
<ul>
<li><a href="https://tryhackme.com/room/sigma">Sigma</a></li>
</ul>
<p><img src="https://miro.medium.com/v2/resize:fit:700/1*KQOhM4G87np1UxDEGD4k1Q.png" alt=""></p>
<h1 id="-sighunt-interface-"><strong>SigHunt Interface</strong></h1>
<p>Before we proceed, let’s deploy the attached machine in this task since it may take up to 3–5 minutes to initialize the services.</p>
<p>We will use this link to access the interface —  <a href="http://machine_ip/">http://MACHINE_IP</a></p>
<h1 id="-how-to-use-the-sighunt-interface-"><strong>How to use the SigHunt Interface:</strong></h1>
<ul>
<li><strong>Run</strong>  — Submit your Sigma rule and see if it detects the malicious IOC.</li>
<li><strong>Text Editor —</strong> Write your Sigma rule in this section.</li>
<li><strong>Create Rule</strong>  — Create a Sigma rule for the malicious IOC.</li>
<li><strong>View Log</strong>  — View the log details associated with the malicious IOC.</li>
</ul>
<p><img src="https://miro.medium.com/v2/resize:fit:700/0*TyEqf9jPmN01WlXR.png" alt=""></p>
<h1 id="-huntme-incident-"><strong>Huntme Incident</strong></h1>
<p><strong>Scenario</strong></p>
<p>You are hired as a Detection Engineer for your organization. During your first week, a ransomware incident has just concluded, and the Incident Responders of your organization have successfully mitigated the threat. With their collective effort, the Incident Response (IR) Team provided the IOCs based on their investigation. Your task is to create Sigma rules to improve the detection capabilities of your organization and prevent future incidents similar to this.</p>
<p><strong>Indicators of Compromise</strong></p>
<p>Based on the given incident report, the Incident Responders discovered the following attack chain:</p>
<ul>
<li>Execution of malicious HTA payload from a phishing link.</li>
<li>Execution of Certutil tool to download Netcat binary.</li>
<li>Netcat execution to establish a reverse shell.</li>
<li>Enumeration of privilege escalation vectors through PowerUp.ps1.</li>
<li>Abused service modification privileges to achieve System privileges.</li>
<li>Collected sensitive data by archiving via 7-zip.</li>
<li>Exfiltrated sensitive data through  <strong>cURL</strong> binary.</li>
<li>Executed ransomware with  <strong>huntme</strong>  as the file extension.</li>
</ul>

          
<h1 id="task-5-detection-mitigation">Task 5 : Detection/Mitigation</h1>
<p>Now that we have gone through the steps to weaponize the  <code>CVE-2023-23397</code>  attack on Outlook, let&#39;s talk about a few ways to detect this attack within the network. Each attack leaves patterns or artifacts that could help the detection team identify the threats. It all depends on the network visibility and the log sources that are being collected and providing the much important visibility.</p>
<p>Here, we will discuss a few ways to detect this attack on the host.</p>
<h2 id="sigma-rules">Sigma Rules</h2>
<p>The following Sigma rule detects Outlook initiating a connection to a WebDav or SMB share, indicating a post-exploitation phase.</p>
<pre><code>title:  CVE<span class="hljs-string">-2023</span><span class="hljs-string">-23397</span>  Exploitation  Attempt  
id:  73c59189<span class="hljs-string">-6</span>a6d<span class="hljs-string">-4</span>b9f-a748<span class="hljs-string">-8</span>f6f9bbed75c  
status:  experimental  
description:  Detects  outlook  initiating  
</code></pre><p>This  <a href="https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_rundll32_webdav_client_susp_execution.yml">Sigma Rule</a>  looks to detect svchost.exe spawning rundll32.exe with command arguments like  <code>C:\windows\system32\davclnt.dll,DavSetCookie</code>, which indicates a post-exploitation/exfiltration phase.</p>
<blockquote>
<p>title: Suspicious WebDav Client Execution<br>id: 982e9f2d-1a85-4d5b-aea4-31f5e97c6555<br>status: experimental<br>description: &#39;Detects &quot;svchost.exe&quot; spawning &quot;rundll32.exe&quot; with command arguments<br>  like C:\windows\system32\davclnt.dll,DavSetCookie. This could be an indicator of<br>  exfiltration or use of WebDav to launch code (hosted on WebDav Server) or potentially<br>  a sign of exploitation of CVE-2023-23397 &#39;<br>references:  </p>
<ul>
<li><a href="https://twitter.com/aceresponder/status/1636116096506818562">https://twitter.com/aceresponder/status/1636116096506818562</a>  </li>
<li><a href="https://www.mdsec.co.uk/2023/03/exploiting-cve-2023-23397-microsoft-outlook-elevation-of-privilege-vulnerability/">https://www.mdsec.co.uk/2023/03/exploiting-cve-2023-23397-microsoft-outlook-elevation-of-privilege-vulnerability/</a>  </li>
<li><a href="https://www.pwndefend.com/2023/03/15/the-long-game-persistent-hash-theft/">https://www.pwndefend.com/2023/03/15/the-long-game-persistent-hash-theft/</a><br>author: Nasreddine Bencherchali (Nextron Systems), Florian Roth (Nextron Systems)<br>date: 2023/03/16<br>tags:  <ul>
<li>attack.exfiltration  </li>
<li>attack.t1048.003  </li>
<li>cve.2023.23397<br>logsource:<br>category: process_creation<br>product: windows<br>detection:<br>selection:<br>ParentImage|endswith: \svchost.exe<br>Image|endswith: \rundll32.exe<br>CommandLine|contains: C:\windows\system32\davclnt.dll,DavSetCookie<br>CommandLine|re: ://\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3}<br>filter_local_ips:<br>CommandLine|contains:  </li>
<li>://10.  </li>
<li>://192.168.  </li>
<li>://172.16.  </li>
<li>://172.17.  </li>
<li>://172.18.  </li>
<li>://172.19.  </li>
<li>://172.20.  </li>
<li>://172.21.  </li>
<li>://172.22.  </li>
<li>://172.23.  </li>
<li>://172.24.  </li>
<li>://172.25.  </li>
<li>://172.26.  </li>
<li>://172.27.  </li>
<li>://172.28.  </li>
<li>://172.29.  </li>
<li>://172.30.  </li>
<li>://172.31.  </li>
<li>://127.  </li>
<li>://169.254.<br>condition: selection and not 1 of filter_*<br>falsepositives:  <ul>
<li>Unknown<br>level: high</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<p>These SIGMA rules can be converted into the detection and monitoring tool to hunt for suspicious log activity within the network. To learn more about SIGMA rules, check this introductory room on  <a href="https://tryhackme.com/room/sigma">Sigma</a>.</p>



</article>
  </div>
  <footer class="footer">
    <span class="footer__copyright">&copy; 2023 - Md Amiruddin</span>
  </footer><br><br>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js?1678894953382991917"></script>

    </div>
  </body>
</html>
